<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zervi Companies Calendar 2025</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Previous styles remain unchanged -->
</head>
<body>
    <!-- Previous HTML structure remains unchanged -->

    <script>
        // Default holidays data with metadata
        const defaultHolidays = {
            thai: [
                { date: '2025-01-01', name: "New Year's Day 2025", category: 'holiday', created: '2025-01-01T00:00:00.000Z', modified: '2025-01-01T00:00:00.000Z' },
                { date: '2025-01-02', name: "New Year's Day 2025", category: 'holiday', created: '2025-01-01T00:00:00.000Z', modified: '2025-01-01T00:00:00.000Z' },
                { date: '2025-04-14', name: "Songkran Festival Day", category: 'holiday', created: '2025-01-01T00:00:00.000Z', modified: '2025-01-01T00:00:00.000Z' },
                { date: '2025-04-15', name: "Songkran Festival Day", category: 'holiday', created: '2025-01-01T00:00:00.000Z', modified: '2025-01-01T00:00:00.000Z' },
                { date: '2025-04-16', name: "Songkran Festival Day", category: 'holiday', created: '2025-01-01T00:00:00.000Z', modified: '2025-01-01T00:00:00.000Z' },
                { date: '2025-04-17', name: "Songkran Festival Day", category: 'holiday', created: '2025-01-01T00:00:00.000Z', modified: '2025-01-01T00:00:00.000Z' },
                { date: '2025-04-18', name: "Songkran Festival Day", category: 'holiday', created: '2025-01-01T00:00:00.000Z', modified: '2025-01-01T00:00:00.000Z' },
                { date: '2025-04-19', name: "Songkran Festival Day", category: 'holiday', created: '2025-01-01T00:00:00.000Z', modified: '2025-01-01T00:00:00.000Z' },
                { date: '2025-05-01', name: "National Labor Day", category: 'holiday', created: '2025-01-01T00:00:00.000Z', modified: '2025-01-01T00:00:00.000Z' },
                { date: '2025-05-12', name: "Visakha Bucha Day", category: 'holiday', created: '2025-01-01T00:00:00.000Z', modified: '2025-01-01T00:00:00.000Z' },
                { date: '2025-06-03', name: "H.M. The Queen's Birthday", category: 'holiday', created: '2025-01-01T00:00:00.000Z', modified: '2025-01-01T00:00:00.000Z' },
                { date: '2025-07-28', name: "H.M. The King's Birthday", category: 'holiday', created: '2025-01-01T00:00:00.000Z', modified: '2025-01-01T00:00:00.000Z' },
                { date: '2025-08-12', name: "Mother's Day", category: 'holiday', created: '2025-01-01T00:00:00.000Z', modified: '2025-01-01T00:00:00.000Z' },
                { date: '2025-10-13', name: "King Bhumibol Adulyadej Memorial Day", category: 'holiday', created: '2025-01-01T00:00:00.000Z', modified: '2025-01-01T00:00:00.000Z' },
                { date: '2025-12-05', name: "Father's Day", category: 'holiday', created: '2025-01-01T00:00:00.000Z', modified: '2025-01-01T00:00:00.000Z' },
                { date: '2025-12-26', name: "Christmas Day Vacation Management", category: 'holiday', created: '2025-01-01T00:00:00.000Z', modified: '2025-01-01T00:00:00.000Z' },
                { date: '2025-12-27', name: "Christmas Day Vacation Management", category: 'holiday', created: '2025-01-01T00:00:00.000Z', modified: '2025-01-01T00:00:00.000Z' },
                { date: '2025-12-29', name: "Christmas Day Vacation Management", category: 'holiday', created: '2025-01-01T00:00:00.000Z', modified: '2025-01-01T00:00:00.000Z' },
                { date: '2025-12-30', name: "Christmas Day Vacation Management", category: 'holiday', created: '2025-01-01T00:00:00.000Z', modified: '2025-01-01T00:00:00.000Z' },
                { date: '2025-12-31', name: "New Year's 2025", category: 'holiday', created: '2025-01-01T00:00:00.000Z', modified: '2025-01-01T00:00:00.000Z' }
            ],
            aus: [
                { date: '2025-01-26', name: "Australia Day", category: 'holiday', created: '2025-01-01T00:00:00.000Z', modified: '2025-01-01T00:00:00.000Z' }
            ]
        };

        // Load holidays from localStorage or use defaults
        let holidays = JSON.parse(localStorage.getItem('zerviCalendar2025')) || defaultHolidays;

        // Save holidays to localStorage
        function saveHolidays() {
            localStorage.setItem('zerviCalendar2025', JSON.stringify(holidays));
        }

        // Initialize calendar on page load
        document.addEventListener('DOMContentLoaded', function() {
            createCalendar();
        });

        // Update addEvent to include metadata and save to localStorage
        function addEvent() {
            const now = new Date().toISOString();
            const event = {
                date: document.getElementById('eventDate').value,
                name: document.getElementById('eventName').value,
                company: document.getElementById('eventCompany').value,
                category: document.getElementById('eventCategory').value,
                description: document.getElementById('eventDescription').value,
                created: now,
                modified: now
            };

            if (!event.date || !event.name) {
                alert('Please fill in required fields (Date and Name)');
                return;
            }

            if (event.company === 'both') {
                holidays.aus.push({...event});
                holidays.thai.push({...event});
            } else {
                holidays[event.company].push(event);
            }

            // Save to localStorage and refresh
            saveHolidays();
            createCalendar();
            
            // Clear form
            document.getElementById('eventDate').value = '';
            document.getElementById('eventName').value = '';
            document.getElementById('eventDescription').value = '';

            // Close the dropdown
            const dropdown = document.querySelector('.dropdown');
            dropdown.classList.remove('active');
        }

        // Update updateEvent to include metadata and save to localStorage
        function updateEvent() {
            const index = parseInt(document.getElementById('editEventIndex').value);
            const company = document.getElementById('editEventCompany').value;
            
            const updatedEvent = {
                date: document.getElementById('editEventDate').value,
                name: document.getElementById('editEventName').value,
                company: document.getElementById('editEventCompanySelect').value,
                category: document.getElementById('editEventCategory').value,
                description: document.getElementById('editEventDescription').value,
                created: holidays[company][index].created || new Date().toISOString(),
                modified: new Date().toISOString()
            };

            if (!updatedEvent.date || !updatedEvent.name) {
                alert('Please fill in required fields (Date and Name)');
                return;
            }

            // Update event
            holidays[company][index] = updatedEvent;
            
            // Save to localStorage and refresh
            saveHolidays();
            createCalendar();
            
            // Close modal
            closeEditModal();
        }

        // Update deleteEvent to save changes to localStorage
        function deleteEvent(date, company, index) {
            const event = holidays[company][index];
            if (confirm(`Are you sure you want to delete "${event.name}" on ${date}?`)) {
                // Remove the event
                holidays[company].splice(index, 1);
                
                // If it was a "both" company event, remove from other company too
                if (event.company === 'both') {
                    const otherCompany = company === 'aus' ? 'thai' : 'aus';
                    const otherIndex = holidays[otherCompany].findIndex(e => 
                        e.date === event.date && e.name === event.name
                    );
                    if (otherIndex !== -1) {
                        holidays[otherCompany].splice(otherIndex, 1);
                    }
                }
                
                // Save to localStorage and refresh
                saveHolidays();
                createCalendar();
            }
        }

        // Update importHolidays to save imported data to localStorage
        function importHolidays() {
            const fileInput = document.getElementById('importFile');
            const file = fileInput.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importedHolidays = JSON.parse(e.target.result);
                        Object.assign(holidays, importedHolidays);
                        saveHolidays();
                        createCalendar();
                        alert('Holidays imported successfully!');
                    } catch (error) {
                        alert('Error importing holidays. Please check the file format.');
                    }
                };
                reader.readAsText(file);
            }
        }

        // Previous event handlers and functions remain unchanged
    </script>

    <!-- Previous modals and additional scripts remain unchanged -->
</body>
</html>
